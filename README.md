## 0.机器人配置

请先安装必要库

```bash
pip install mcrcon
```

关于机器人配置，这里不再赘述，请去官网 https://nonebot.dev/ 查看，也可以询问ai，需要注意的是，本机器人插件不是使用pip安装的，所以，你需要在 `pyproject.toml`里写入以下内容，然后将 `QAuth_nb2` 放入机器人目录下的 `plugins` 文件夹
```toml
[tool.nonebot]
adapters = [
    { name = "OneBot V11", module_name = "nonebot.adapters.onebot.v11" }
]
plugin_dirs = ["plugins"] #主要是这一行
builtin_plugins = []
```
## 1. 玩家指南 (Player Guide)

**适用对象**：所有进入服务器的玩家。

当玩家进入服务器时，如果未绑定 QQ，将会被**限制移动**并收到屏幕提示。

### 游戏内指令
| 指令    | 描述                                          | 示例    |
| :------ | :-------------------------------------------- | :------ |
| `/link` | 获取绑定验证码。系统会生成一个 6 位随机代码。 | `/link` |

### 机器人指令 (QQ)
| 指令               | 描述                                       | 示例            |
| :----------------- | :----------------------------------------- | :-------------- |
| `绑定 <验证码>`    | 发送在游戏内获取的验证码，完成绑定并解锁。 | `绑定 a1b2c3`   |
| `/mc查询 <游戏名>` | 查询某个游戏 ID 绑定了哪个 QQ。            | `/mc查询 Steve` |
| `/查绑定 <游戏名>` | 同上，别名指令。                           | `/查绑定 Steve` |

---

## 2. 管理员指南 (Admin Guide)
**适用对象**：服务器 OP、后台管理员、机器人超级用户。

### 游戏内管理指令 (QAuth 插件)
*   **权限节点**：`qauth.admin` (默认 OP 拥有)
*   **主指令**：`/qadmin`

| 指令                    | 描述                        | 备注                                                   |
| :---------------------- | :-------------------------- | :----------------------------------------------------- |
| `/qadmin help`          | 查看管理员帮助菜单。        | 显示所有可用指令                                       |
| `/qadmin unlock <ID>`   | **强制解锁**指定玩家。      | 无论该玩家是否绑定QQ，直接解除移动限制并打上验证标签。 |
| `/qadmin verify <code>` | **(内部指令)** 验证码回调。 | **请勿手动输入**，这是给机器人 RCON 自动调用的接口。   |

### 机器人管理指令 (QQ)
*   **权限要求**：需要在 `.env` 文件中配置 `SUPERUSERS`。

| 指令                     | 描述                                                         | 示例                      |
| :----------------------- | :----------------------------------------------------------- | :------------------------ |
| `/更改mc信息 <ID> @某人` | **强制绑定/改绑**。强制将游戏ID绑定给指定QQ。如果玩家在线且被冻结，会同步解锁。 | `/更改mc信息 Steve @李四` |
| `/强制绑定 <ID> @某人`   | 同上，别名指令。                                             | `/强制绑定 Steve @张三`   |

---

## 3. 部署与配置

如果你需要重新部署或迁移服务器，请参考以下配置。

### Minecraft 服务端设置
文件：`server.properties`
必须确保 RCON 开启，且密码与机器人配置一致。
```properties
enable-rcon=true
rcon.port=25575
rcon.password=你的rcon密码
broadcast-rcon-to-ops=false
```

###  机器人设置
文件：`.env`
```properties
# 基础配置
COMMAND_START=["/"]
SUPERUSERS=["你的QQ号"]

# MC 服务器 RCON 配置 (必须与 server.properties 一致)
RCON_HOST=127.0.0.1
RCON_PORT=25575
RCON_PASSWORD=你的强密码
```

### 数据库说明
*   **文件位置**：机器人根目录下的 `data.db` (SQLite)。
*   **表结构**：
    *   `qq_id` (TEXT, 主键)
    *   `game_name` (TEXT, 唯一)
    *   `created_at` (时间戳)

---

## 4. 常见问题 (FAQ)

**Q: 玩家输入 `/link` 后，机器人提示“连接服务器失败”？**
*   **A**: 检查 Minecraft 服务器是否已完全启动（显示 Done!）。
*   **A**: 检查 `server.properties` 里的 `rcon.password` 是否和机器人 `.env` 里的一样。
*   **A**: 检查服务器防火墙是否放行了 25575 端口。

**Q: 我在控制台/后台输入 `/link` 提示“只有玩家可以使用”？**
*   **A**: `/link` 获取验证码需要绑定到一个具体的在线玩家身上，控制台没有实体，所以无法使用。请在游戏内输入。

**Q: 正版玩家改名了怎么办？**
*   **A**: 现在的逻辑是基于**游戏名**绑定的。如果玩家改名，系统会视其为新玩家（未绑定）。他需要重新输入 `/link` 绑定。管理员也可以使用 `/更改mc信息` 帮他迁移数据。